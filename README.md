<div align="center">
  <h1>Order Management</h1>
  <p>Sistema de gerenciamento de pedidos para autoatendimento de fast food</p>

[![Kotlin Language](https://img.shields.io/static/v1?label=kotlin&message=language&color=purple&style=for-the-badge&logo=KOTLIN)](https://kotlinlang.org/)
[![Gradle Automation](https://img.shields.io/static/v1?label=gradle&message=Tool&color=darkgreen&style=for-the-badge&logo=GRADLE)](http://www.gnu.org/licenses/agpl-3.0)
[![SpringBoot Framework](https://img.shields.io/static/v1?label=springboot&message=framework&color=green&style=for-the-badge&logo=SPRINGBOOT)](https://opensource.org/licenses/)
[![Postgres Database](https://img.shields.io/static/v1?label=postgres&message=database&color=blue&style=for-the-badge&logo=POSTGRESQL)](http://www.gnu.org/licenses/agpl-3.0)
[![Flyway Migration](https://img.shields.io/static/v1?label=flyway&message=migration&color=red&style=for-the-badge&logo=FLYWAY)](http://www.gnu.org/licenses/agpl-3.0)
[![Docker Container](https://img.shields.io/static/v1?label=docker&message=container&color=lightblue&style=for-the-badge&logo=DOCKER)](http://www.gnu.org/licenses/agpl-3.0)
</div>

## Vis√£o Geral

Projeto desenvolvido para gerenciamento de autoatendimento de restaurantes, tendo como funcionalidades:

- Gerenciamento de pedidos
- Gerenciamento de clientes
- Gerenciamento de produtos
- Gerenciamento de pagamento

## √çndice

- [Vis√£o Geral](#vis√£o-geral)
- [Requisitos de Neg√≥cio](#requisitos-de-neg√≥cio)
- [Arquitetura de Infraestrutura](#arquitetura-de-infraestrutura)
- [Documenta√ß√£o da API](#documenta√ß√£o-da-api)
- [Configura√ß√£o do Ambiente](#configura√ß√£o-do-ambiente)
- [Desenvolvimento](#desenvolvimento)
- [Equipe](#desenvolvedores)

## Requisitos de Neg√≥cio

### Gerenciamento de Produtos
<details>
<summary>Clique para expandir</summary>

#### Cadastro de Produtos
![Cadastro de Produtos](files/cria-produto.png)

#### Atualiza√ß√£o de Produtos
![Atualiza√ß√£o de Produtos](files/atualiza-produto.png)

#### Consulta de Produtos
![Consulta de Produtos](files/consulta-produtos.png)

#### Produtos por Categoria
![Produtos por Categoria](files/consulta-produtos-categoria.png)

#### Consulta por ID
![Consulta por ID](files/consulta-produto.png)

#### Remo√ß√£o de Produtos
![Remo√ß√£o de Produtos](files/apaga-produto.png)
</details>

### Gerenciamento de Clientes
<details>
<summary>Clique para expandir</summary>

#### Cadastro de Cliente
![cria-cliente.png](files/cria-cliente.png)

#### Consulta Clientes
![Consulta de Clientes](files/consulta-usuarios.jpg)

#### Consulta cliente por identificador
![consulta-cliente.png](files/consulta-cliente.png)

#### Consulta cliente por cpf
![consulta-cliente-cpf.png](files/consulta-cliente-cpf.png)

#### Consulta cliente por email
![consulta-cliente-email.png](files/consulta-cliente-email.png)

#### Atualiza√ß√£o de dados de Clientes
![atualiza.png](files/atualiza.png)

#### Deleta Clientes
![apaga-cliente.png](files/apaga-cliente.png)
</details>

### Gerenciamento de Pedidos
<details>
<summary>Clique para expandir</summary>

#### Cadastro de pedido
![cria-pedido.png](files/cria-pedido.png)

#### Atualiza√ß√£o de pedido
![atualiza-pedido.png](files/atualiza-pedido.png)

#### Consulta de pedidos
![consulta-pedidos.png](files/consulta-pedidos.png)

#### Consulta pedidos por Status
![consulta-pedidos-por-status.png](files/consulta-pedidos-por-status.png)

#### Consulta por ID
![consulta-pedido.png](files/consulta-pedido.png)

#### Cancelamento de pedido
![deleta-pedido.png](files/deleta-pedido.png)
</details>

### Gerenciamento de Pagamentos
<details>
<summary>Clique para expandir</summary>

#### Consulta de pagamento por identificador
![consulta-pagamento.png](files/consulta-pagamento.png)

#### Cria√ß√£o de pagamento para hist√≥rico e gera√ß√£o de QRCode no provedor
![cria-pagamento.png](files/cria-pagamento.png)

#### Processamento de webhook do provedor
![processa-webhook.png](files/processa-webhook.png)
</details>

## Arquitetura de Infraestrutura

A arquitetura implementada segue os seguintes princ√≠pios:

- Uma **VPC** com tr√™s **subnets p√∫blicas**
- Um cluster **EKS** com dois n√≥s
- O backend em **Kotlin** √© containerizado e roda no Kubernetes
- O banco de dados **PostgreSQL** tamb√©m √© executado no cluster via StatefulSet
- Uso de **Secrets** e **ConfigMaps**
- Suporte a escalabilidade com **Horizontal Pod Autoscaler (HPA)**, usando o **metrics-server**
- Imagens Docker armazenadas no **ECR**
- Acesso externo ao backend via **LoadBalancer**

![consulta-pedidos.jpg](files/arquitetura-aws-v1.jpg)

---

## Passo a passo para Deploy


### Pr√©-requisitos

Certifique-se de ter as ferramentas abaixo instaladas em sua m√°quina:

| Ferramenta     | Link de instala√ß√£o oficial |
|----------------|----------------------------|
| **AWS CLI**    | [Instalar AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html) |
| **Terraform**  | [Instalar Terraform](https://developer.hashicorp.com/terraform/downloads) |
| **kubectl**    | [Instalar kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/) |
| **Docker**     | [Instalar Docker](https://docs.docker.com/get-docker/) |
| **k9s (opcional)** | [Instalar k9s](https://k9scli.io/topics/install/) |

> üí° Ap√≥s instalar tudo, verifique se os comandos `aws`, `terraform`, `kubectl`, `docker` e `k9s` funcionam no terminal.

---

### Atualizar credenciais AWS

Obtenha as credencias no aws details apos iniciar o lab na AWS Academy e altere no arquivo `.aws/credentials`

```text
[default]
aws_access_key_id=
aws_secret_access_key=
aws_session_token=
```

### 1. Inicializar o Terraform

```bash
cd terraform
terraform init -upgrade
terraform plan
terraform apply
```

### 2. Outputs esperados

Exemplo de Output:
```text
Changes to Outputs:
  + aws_s3_bucket_name = "tc-fiap-fast-food-16299ad5"
  + ecr_repository_url = "780442003514.dkr.ecr.us-east-1.amazonaws.com/tc-fiap-fast-food-repo"
  + subnet_cidr        = ["10.0.0.0/20", "10.0.16.0/20", "10.0.32.0/20"]
  + subnet_id          = ["subnet-0d91047b52fb85718", "subnet-0ab84ebfc5aa251a2", ...]
  + vpc_cidr           = "10.0.0.0/16"
  + vpc_id             = "vpc-04de6c3e5bbadc5fb"
```

> üí° Lembre-se: os outputs serao diferentes, ent√£o se atente a mudar onde √© necessario `ecr_repository_url`.

## Docker e ECR

### 3. Autenticar no ECR

```bash
aws ecr get-login-password | docker login --username AWS --password-stdin <ecr_repository_url>
```

### 4. Build e push da imagem Docker

```bash
cd ..
# Build da imagem
docker build -t order-management:latest -f docker/Dockerfile .

# Tag da imagem com a URL do ECR
docker tag order-management:latest <ecr_repository_url>:latest

# Push da imagem para o ECR
docker push <ecr_repository_url>:latest
```

---

## ‚ò∏Ô∏è Configurar o cluster EKS

### 5. Atualizar o kubeconfig

```bash
aws eks update-kubeconfig --name eks-cluster-tc-fiap-fast-food --region us-east-1
```

### 6. Verificar conex√£o com o cluster

```bash
kubectl get nodes
```

(opcional) usar o [k9s](https://k9scli.io/) para visualiza√ß√£o interativa:

```bash
k9s
```

---

## üìä Instalar metrics-server (para HPA)

```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

---

## Aplicar PostgreSQL

```bash
kubectl apply -f k8s/postgres
```

---

## Deploy do App Backend

### 7. Atualizar o campo `image` do Deployment

Antes de aplicar o backend, edite o arquivo `k8s/app/deployment.yaml` e altere o campo `image:` para a URL da imagem no seu ECR:

```yaml
image: <ecr_repository_url>:latest
```

### 8. Aplicar os manifests do backend

```bash
kubectl apply -f k8s/app
```

---

## Acessar o servi√ßo

### 9. Obter o IP externo do servi√ßo

```bash
kubectl get svc
```

Procure pela linha do `order-management` com o tipo `LoadBalancer` e anote o `EXTERNAL-IP`.

### 10. Testar Probes (opcional)

```bash
curl http://<EXTERNAL-IP>:8080/actuator/health/readiness
curl http://<EXTERNAL-IP>:8080/actuator/health/liveness
```

---

## üßπ Limpar recursos

### 11. Deletar os recursos Kubernetes

```bash
kubectl delete -f k8s/app
kubectl delete -f k8s/postgres
```

### 12. Destruir a infraestrutura AWS

```bash
terraform destroy
```

## Documenta√ß√£o da API

A documenta√ß√£o interativa da API est√° dispon√≠vel atrav√©s do Swagger UI:
- **URL**: http://localhost:8080/swagger-ui.html

### Collection Postman

Para facilitar os testes, disponibilizamos uma collection do Postman com exemplos de requisi√ß√µes:

[![Run in Postman](https://run.pstmn.io/button.svg)](https://github.com/11SOAT-Tech-Challenge-Fast-Food/order-management/blob/main/postman/collections/order-management.postman_collection.json)

## Configura√ß√£o do Ambiente

### Iniciando com Docker

#### Pr√©-requisitos

- Docker 20.10+
- Docker Compose 2.0+
- Git
- JDK 17+ (opcional, apenas para desenvolvimento)

1. **Clone o reposit√≥rio**
   ```bash
   git clone https://github.com/11SOAT-Tech-Challenge-Fast-Food/order-management.git
   cd order-management
   ```

2. **Configure as vari√°veis de ambiente**
   ```bash
   Edite o arquivo variables-docker.env conforme necess√°rio
   ```

3. **Inicie os containers**
   ```bash
   docker-compose -f docker/docker-compose.yml up -d
   ```

4. **Acesse a aplica√ß√£o**
   - API: http://localhost:8080
   - Swagger UI: http://localhost:8080/swagger-ui.html
   - Banco de Dados: localhost:5432

5. **Parando a aplica√ß√£o**
   ```bash
   docker-compose -f docker/docker-compose.yml down
   ```

### Iniciando com Kubernets

TODO

## Desenvolvimento

### Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ kotlin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ br/com/fiap/ordermanagement/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ customer/            # Separa√ß√£o por dom√≠nio
‚îÇ   ‚îÇ       ‚îÇ  ‚îú‚îÄ‚îÄ common/             # Classes comuns ao mundo externo e interno
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ dtos/               # Classes de transfer√™ncia de dados
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ interfaces/         # Contrato de implementa√ß√£o do mundo externo
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ mapper/             # Mapeamento de entidade para DTO e DTO para entidade
‚îÇ   ‚îÇ       ‚îÇ  ‚îú‚îÄ‚îÄ core/               # Classes de dom√≠nio
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ controllers/        # Entrada do mundo externo
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ entities/           # Entidades do dom√≠nio
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ gateways/           # Comunica√ß√£o com sistemas externos
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ presenters/         # Adaptador de dados para o mundo externo
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ usecases/           # Casos de uso da regra de neg√≥cio
‚îÇ   ‚îÇ       ‚îÇ  ‚îú‚îÄ‚îÄ external/           # Classes de acesso externo
‚îÇ   ‚îÇ       ‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ api/                # Implementa√ß√£o de rest API
‚îÇ   ‚îÇ       ‚îÇ  ‚îî‚îÄ‚îÄ‚îî‚îÄ‚îÄ persistence/        # Implementa√ß√£o do banco de dados
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ order/               # Separa√ß√£o por dom√≠nio de pedido - Seguindo a estrutura do customer
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ payment/             # Separa√ß√£o por dom√≠nio de pagamento - Seguindo a estrutura do customer
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ product/             # Separa√ß√£o por dom√≠nio de produto - Seguindo a estrutura do customer
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ OrderManagementApplication.kt
‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ       ‚îú‚îÄ‚îÄ db/migration/        # Scripts do Flyway
‚îÇ       ‚îî‚îÄ‚îÄ application.yml      # Configura√ß√µes da aplica√ß√£o
‚îî‚îÄ‚îÄ test/                        # Testes automatizados
```

### Padr√µes de C√≥digo

- Siga clean architecture
- Utilize nomes descritivos para vari√°veis e fun√ß√µes
- Documente fun√ß√µes e classes p√∫blicas
- Escreva testes unit√°rios para novas funcionalidades

## Desenvolvedores
| [<img loading="lazy" src="https://avatars.githubusercontent.com/u/79323910?v=4" width=115><br><sub>Bianca Vediner</sub>](https://github.com/BiaVediner) | [<img loading="lazy" src="https://avatars.githubusercontent.com/u/79324306?v=4" width=115><br><sub>Wesley Paternezi</sub>](https://github.com/WesleyPaternezi) | [<img loading="lazy" src="https://avatars.githubusercontent.com/u/61800458?v=4 " width=115><br><sub>Guilherme Paternezi</sub>](https://github.com/guilherme-paternezi) |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------:|